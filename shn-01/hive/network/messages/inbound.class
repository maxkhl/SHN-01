--[[
    SHN-01 Network Inbound message Class
        This class represents an inbound network message in the SHN-01 system.
        It handles the creation and management of messages received over the network.
]]
local inbound = newClass(class("../message"))

function inbound:constructor(address, node, protocol, distance, ...)
    assert(self, "Must be called on a object")
    if node and node.address ~= address then
        error("Node address does not match message address")
    end


    self.node = node
    self.base:constructor(address, protocol, distance, ...)
    local dataParts = {}
    for i = 1, #self.data do
        dataParts[i] = tostring(self.data[i])
    end
    local dataStr = table.concat(dataParts, ", "):gsub("[\n\r]", " ")
    debugPrint("Receiving message on protocol <c=0xFFFFFF>" .. protocol.name .. "</c>: " .. (#dataStr > 100 and (dataStr:sub(1, 100) .. "...") or dataStr), node, 2)
end

function inbound:__tostring()
    assert(self, "Must be called on a object")
    return "[Message] from <c=0xFFFF00>" .. tostring(self.node.id) .. "</c> via <c=0xFFFF00>" .. tostring(self.protocol.name) .. "</c> at distance <c=0xFFFF00>" .. tostring(self.distance) .. "</c> with data: <c=0xFFFFFF>" .. table.concat(self.data, ", ") .. "</c>"
end

function inbound:senderString()
    assert(self, "Must be called on a object")
    return "[Sender] <c=0xFFFF00>" .. tostring(self.node.id) .. "</c> at distance <c=0xFFFF00>" .. tostring(self.distance) .. "</c>"
end

return inbound