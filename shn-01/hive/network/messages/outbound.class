--[[
    SHN-01 Network Outbound message Class
        This class represents an outbound network message in the SHN-01 system.
        It handles the creation and management of messages sent over the network.
]]
local outbound = newClass(class("../message"))

function outbound:constructor(node, protocol, distance, ...)
    assert(self, "Must be called on a object")
    self.node = node
    self.base.constructor(self,node.address, protocol, distance, ...)
end

-- Sends the outbound message over the network
function outbound:send()
    assert(self, "Must be called on a object")
    local modem = getComponent("modem")
    local dataStr = table.concat(self.data, ", "):gsub("[\n\r]", " ")
    debugPrint("Sending message to <c=0xFFFFFF>" .. self.remoteAddress .. "</c> on port <c=0xFFFFFF>" .. self.protocol.port .. "</c>: " .. (#dataStr > 50 and (dataStr:sub(1, 50) .. "...") or dataStr))
    modem.send(self.remoteAddress, self.protocol.port, table.unpack(self.data))
end

function outbound:__tostring()
    assert(self, "Must be called on a object")
    return "[Message] from <c=0xFFFF00>" .. tostring(self.node.id) .. "</c> via <c=0xFFFF00>" .. tostring(self.protocol.name) .. "</c> at distance <c=0xFFFF00>" .. tostring(self.distance) .. "</c> with data: <c=0xFFFFFF>" .. table.concat(self.data, ", ") .. "</c>"
end

function outbound:senderString()
    assert(self, "Must be called on a object")
    return "[Sender] <c=0xFFFF00>" .. tostring(self.node.id) .. "</c> at distance <c=0xFFFF00>" .. tostring(self.distance) .. "</c>"
end

return outbound