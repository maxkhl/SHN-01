--[[
    SHN-01 Network Outbound message Class
        This class represents an outbound network message in the SHN-01 system.
        It handles the creation and management of messages sent over the network.
]]
local outbound = newClass(class("../message"))

function outbound:constructor(node, protocol, distance, ...)
    assert(self, "Must be called on a object")
    self.node = node
    self.base:constructor(node.address, protocol, distance, ...)
end

-- Sends the outbound message over the network
function outbound:send()
    assert(self, "Must be called on a object")
    local modem = getComponent("modem")
    modem.send(self.remoteAddress, self.protocol.port, table.unpack(self.payload))
end

function outbound:__tostring()
    assert(self, "Must be called on a object")
    return "<c=0x00FFFF>[Message]</c> from <c=0xFFFF00>" .. tostring(self.node.id) .. "</c> via <c=0xFFFF00>" .. tostring(self.protocol.name) .. "</c> at distance <c=0xFFFF00>" .. tostring(self.distance) .. "</c> with data: <c=0xFFFFFF>" .. table.concat(self.data, ", ") .. "</c>"
end

function outbound:senderString()
    assert(self, "Must be called on a object")
    return "<c=0x00FFFF>[Sender]</c> <c=0xFFFF00>" .. tostring(self.node.id) .. "</c> at distance <c=0xFFFF00>" .. tostring(self.distance) .. "</c>"
end

return outbound