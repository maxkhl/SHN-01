--[[
    SHN-01 Network Outbound message Class
        This class represents an outbound network message in the SHN-01 system.
        It handles the creation and management of messages sent over the network.
]]
local outbound = newClass(class("../message"))

function outbound:constructor(node, protocol, distance, highPriority, ...)
    assert(self, "Must be called on a object")
    self.node = node
    self.highPriority = highPriority or false
    self.base.constructor(self,node.address, protocol, distance or 999999, ...)
end

-- Inserts a parameter at the specified position in the data array
function outbound:insertParameter(position, value)
    assert(self, "Must be called on a object")
    assert(position, "No position given")
    assert(position >= 1 and position <= #self.data + 1, "Position out of bounds")
    table.insert(self.data, position, value)
end

-- Sends the outbound message over the network
function outbound:send()
    assert(self, "Must be called on a object")
    server.outboundQueue:enqueue(self)
end

function outbound:__tostring()
    assert(self, "Must be called on a object")
    return "[Message] from <c=0xFFFF00>" .. tostring(self.node.id) .. "</c> via <c=0xFFFF00>" .. tostring(self.protocol.name) .. "</c> at distance <c=0xFFFF00>" .. tostring(self.distance) .. "</c> with data: <c=0xFFFFFF>" .. table.concat(self.data, ", ") .. "</c>"
end

function outbound:senderString()
    assert(self, "Must be called on a object")
    return "[Sender] <c=0xFFFF00>" .. tostring(self.node.id) .. "</c> at distance <c=0xFFFF00>" .. tostring(self.distance) .. "</c>"
end

return outbound